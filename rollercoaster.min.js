(function(){function a(){c.width=window.innerWidth-d.offsetWidth;c.height=d.offsetHeight;c.style.width=c.width+"px";c.style.height=c.height+"px";e.stop();e.q()}function b(a){window.requestAnimationFrame(b);e.D(a)}var d,c,e;window.onload=function(){d=document.getElementById("controls");c=document.getElementById("main");e=new g(c,document.getElementById("dt"),document.getElementById("start"),document.getElementById("stop"),document.getElementById("reset"),document.getElementById("mass"),document.getElementById("grav"),
document.getElementById("npoints"),document.getElementById("type"),document.getElementById("solver"));a();window.onresize=a;window.requestAnimationFrame(b)};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame})();function k(a,b){this.x=a;this.y=b}k.prototype.add=function(a){return new k(this.x+a.x,this.y+a.y)};k.prototype.sub=function(a){return new k(this.x-a.x,this.y-a.y)};function l(a,b){return new k(a.x*b,a.y*b)};function m(a){2<=a.length&&(this.a=a,this.update())}m.prototype.update=function(){this.h=this.a.length-1;var a=this.h-1;this.v=[];for(var b=0;b<=a;b++)this.v.push(this.a[b+1].sub(this.a[b]));a=this.h-2;this.P=[];for(b=0;b<=a;b++)this.P.push(this.v[b+1].sub(this.v[b]))};m.prototype.e=function(a){var b=new k(0,0);this.a.forEach(function(d,c){b=b.add(l(d,n(this.h,c,a)))},this);return b};
m.prototype.N=function(a){var b=this.h-1,d=new k(0,0);this.v.forEach(function(c,e){d=d.add(l(c,n(b,e,a)))},this);return l(d,this.h)};m.prototype.O=function(a){var b=this.h-2,d=new k(0,0);this.P.forEach(function(c,e){d=d.add(l(c,n(b,e,a)))},this);return l(d,this.h*(this.h-1))};function n(a,b,d){for(var c=1,e=1,f=b+1;f<=a;f++)c*=f;for(var f=a-b,h=2;h<=f;h++)e*=h;return c/e*Math.pow(1-d,a-b)*Math.pow(d,b)};function p(a){this.a=a;this.M=[];this.C=[];this.r=[];this.m=[];this.update()}
p.prototype.update=function(){this.m=[];var a=this.a.length-1,b=[],d=[],c=[],e=[];d[0]=0;b[0]=2;c[0]=1;e[0]=l(this.a[1].sub(this.a[0]),3);for(var f=1;f<a;f++)d[f]=1,b[f]=4,c[f]=1,e[f]=l(this.a[f+1].sub(this.a[f-1]),3);d[a]=1;b[a]=2;c[a]=0;e[a]=l(this.a[a].sub(this.a[a-1]),3);c[0]/=b[0];e[0]=l(e[0],1/b[0]);for(f=1;f<=a;f++){var h=1/(b[f]-d[f]*c[f-1]);c[f]*=h;e[f]=l(e[f].sub(l(e[f-1],d[f])),h)}for(b=a-1;0<=b;b--)e[b]=e[b].sub(l(e[b+1],c[b]));for(c=0;c<a;c++)this.M[c]=this.a[c],this.C[c]=e[c],this.r[c]=
l(this.a[c+1].sub(this.a[c]),3).sub(l(e[c],2)).sub(e[c+1]),this.m[c]=l(this.a[c].sub(this.a[c+1]),2).add(e[c]).add(e[c+1])};function q(a,b){var d=b*(a.a.length-1),c=Math.max(Math.min(Math.floor(d),a.a.length-2),0);return{b:d-c,g:c}}p.prototype.e=function(a){a=q(this,a);return this.M[a.g].add(l(this.C[a.g],a.b)).add(l(this.r[a.g],Math.pow(a.b,2))).add(l(this.m[a.g],Math.pow(a.b,3)))};
p.prototype.N=function(a){a=q(this,a);return l(this.C[a.g].add(l(this.r[a.g],2*a.b)).add(l(this.m[a.g],3*Math.pow(a.b,2))),this.a.length-1)};p.prototype.O=function(a){a=q(this,a);return l(l(this.r[a.g],2).add(l(this.m[a.g],6*a.b)),Math.pow(this.a.length-1,2))};function r(a){this.d=null;this.canvas=a;this.c=a.getContext("2d");this.o=[];this.l=[];this.k=!1;this.n=-1;this.canvas.onmousedown=this.Z.bind(this);this.canvas.onmouseup=this.aa.bind(this);this.canvas.onmousemove=this.$.bind(this);this.U=4;this.T="#073642";this.outlineWidth=2;this.outlineColor="#93a1a1";this.H=6;this.W=1.25*this.H;this.ca=Math.pow(this.H,2);this.X=Math.pow(this.W,2);this.S=200;this.ba=["#dc322f","#b58900","#859900"];this.Q=50}
function s(a){a.d.update();a.o=[];for(var b=1/a.S,d=0,c=0;c<=a.S;c++)a.o.push(a.d.e(d)),d+=b}
r.prototype.D=function(a){this.c.save();!0===a&&(this.c.lineJoin="round",this.c.strokeStyle=this.outlineColor,this.c.lineWidth=this.outlineWidth,this.c.beginPath(),this.c.moveTo(this.d.a[0].x,this.d.a[0].y),this.d.a.forEach(function(a){this.c.lineTo(a.x,a.y)},this),this.c.stroke());this.c.strokeStyle=this.T;this.c.lineWidth=this.U;this.c.beginPath();this.c.moveTo(this.o[0].x,this.o[0].y);this.o.forEach(function(a){this.c.lineTo(a.x,a.y)},this);this.c.stroke();!0===a&&this.d.a.forEach(function(a,d){this.c.fillStyle=
this.ba[this.l[d]];var c=this.c,e=a.x,f=a.y,h=this.H;c.beginPath();c.arc(e,f,h,0,2*Math.PI,!1);c.fill()},this);this.c.restore()};r.prototype.Z=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);this.d.a.some(function(a,c){return Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)<this.X?(this.l[c]=2,this.k=!0,this.n=c,!0):!1},this)};r.prototype.aa=function(){!0===this.k&&(this.l[this.n]=1,this.k=!1,this.n=-1)};
r.prototype.$=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);!0===this.k?(this.d.a[this.n]=b,s(this)):!1===this.k&&this.d.a.forEach(function(a,c){this.l[c]=Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)>this.ca?0:1},this)};function t(a,b,d){this.e=a;this.b=0;this.y=null;this.i=b;this.j=3<=arguments.length?arguments[2]:void 0}t.prototype.R=function(a){var b=a-this.b;a=Math.floor(b/this.i);for(var b=b-a*this.i,d=0;d<a;d++)this.step(this.i);this.step(b)};t.prototype.step=function(a){var b=this.e(this.b,this.y,this.j);this.y.forEach(function(d,c,e){e[c]=d+a*b[c]},this);this.b+=a};function u(a,b,d){this.e=a;this.b=0;this.y=null;this.i=b;this.j=3<=arguments.length?arguments[2]:void 0}u.prototype.R=function(a){var b=a-this.b;a=Math.floor(b/this.i);for(var b=b-a*this.i,d=0;d<a;d++)this.step(this.i);this.step(b)};
u.prototype.step=function(a){var b=a/2,d=this.e(this.b,this.y,this.j),c=this.e(this.b+b,w(this.y,d,b),this.j),e=this.e(this.b+b,w(this.y,c,b),this.j),f=this.e(this.b+a,w(this.y,e,a),this.j),h=a/6;this.y.forEach(function(a,b,v){v[b]=a+h*(d[b]+2*c[b]+2*e[b]+f[b])},this);this.b+=a};function w(a,b,d){var c=[];a.forEach(function(a,f){c.push(a+b[f]*d)});return c};function g(a,b,d,c,e,f,h,y,z,v){this.canvas=a;this.c=this.canvas.getContext("2d");this.K=d;this.K.onclick=this.start.bind(this);this.L=c;this.L.onclick=this.stop.bind(this);this.t=y;this.t.onchange=this.q.bind(this);this.u=z;this.u.onchange=this.q.bind(this);this.I=e;this.I.onclick=this.q.bind(this);this.w=b;this.w.onchange=this.J.bind(this);this.B=v;this.B.onchange=this.J.bind(this);this.F=h;this.G=f;this.A=new r(this.canvas);this.q();this.p={};this.J();this.Y=10/60;this.s=!1}
g.prototype.q=function(){var a=this.A,b=parseInt(this.t.value,10)-1,d=parseInt(this.u.value,10),c=[];a.l=[];a.k=!1;a.n=-1;for(var e=new k(a.Q,a.canvas.height/2),f=(new k(a.canvas.width-a.Q,a.canvas.height/2)).sub(e),h=0;h<=b;h++)c.push(e.add(l(f,h/b))),a.l.push(0);a.d=0===d?new m(c):new p(c);s(a)};g.prototype.J=function(){var a=0.001*parseFloat(this.w.value);this.f=0===parseInt(this.B.value,10)?new t(x,a,this.p):new u(x,a,this.p)};
g.prototype.start=function(){this.p.d=this.A.d;this.p.V=-1*parseFloat(this.F.value);this.p.da=parseFloat(this.G.value);this.f.b=null;this.f.y=[0,0];this.K.style.display="none";this.L.style.display="inline";this.I.disabled=!0;this.F.disabled=!0;this.G.disabled=!0;this.w.disabled=!0;this.B.disabled=!0;this.t.disabled=!0;this.s=this.u.disabled=!0};
g.prototype.stop=function(){this.s=!1;this.L.style.display="none";this.K.style.display="inline";this.I.disabled=!1;this.F.disabled=!1;this.G.disabled=!1;this.w.disabled=!1;this.B.disabled=!1;this.t.disabled=!1;this.u.disabled=!1};
g.prototype.D=function(a){this.c.clearRect(0,0,this.canvas.width,this.canvas.height);this.A.D(!this.s);if(!0===this.s)if(a*=0.001,null===this.f.b&&(this.f.b=a),a-this.f.b>this.Y&&(this.f.b=a),this.f.R(a),1>=this.f.y[0]&&0<=this.f.y[0]){this.c.fillStyle="#268bd2";var b=this.A.d.e(this.f.y[0]);a=this.c;var d=b.x,b=b.y;a.beginPath();a.arc(d,b,10,0,2*Math.PI,!1);a.fill()}else this.stop()};
function x(a,b,d){d.d.e(b[0]);a=d.d.N(b[0]);var c=d.d.O(b[0]);return[b[1],-1/(a.x*a.x+a.y*a.y)*((a.x*c.x+a.y*c.y)*Math.pow(b[1],2)+d.V*a.y)]};
