(function(){function a(){c.width=window.innerWidth-d.offsetWidth;c.height=d.offsetHeight;c.style.width=c.width+"px";c.style.height=c.height+"px";e.stop();e.r()}function b(a){window.requestAnimationFrame(b);e.L(a)}var d,c,e;window.onload=function(){d=document.getElementById("controls");c=document.getElementById("main");e=new g(c,document.getElementById("dt"),document.getElementById("start"),document.getElementById("stop"),document.getElementById("reset"),document.getElementById("mass"),document.getElementById("gacc"),
document.getElementById("gcoeff"),document.getElementById("npoints"),document.getElementById("type"),document.getElementById("solver"),document.getElementById("force"),document.getElementById("pot"),document.getElementById("lin"),document.getElementById("central"));a();window.onresize=a;window.requestAnimationFrame(b)};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame})();function k(a,b){this.x=a;this.y=b}k.prototype.add=function(a){return new k(this.x+a.x,this.y+a.y)};k.prototype.sub=function(a){return new k(this.x-a.x,this.y-a.y)};function l(a,b){return new k(a.x*b,a.y*b)}function m(a,b){return a.x*b.x+a.y*b.y};function n(a){2<=a.length&&(this.a=a,this.update())}n.prototype.update=function(){this.i=this.a.length-1;var a=this.i-1;this.w=[];for(var b=0;b<=a;b++)this.w.push(this.a[b+1].sub(this.a[b]));a=this.i-2;this.Z=[];for(b=0;b<=a;b++)this.Z.push(this.w[b+1].sub(this.w[b]))};n.prototype.e=function(a){var b=new k(0,0);this.a.forEach(function(d,c){b=b.add(l(d,p(this.i,c,a)))},this);return b};
n.prototype.J=function(a){var b=this.i-1,d=new k(0,0);this.w.forEach(function(c,e){d=d.add(l(c,p(b,e,a)))},this);return l(d,this.i)};n.prototype.K=function(a){var b=this.i-2,d=new k(0,0);this.Z.forEach(function(c,e){d=d.add(l(c,p(b,e,a)))},this);return l(d,this.i*(this.i-1))};function p(a,b,d){for(var c=1,e=1,f=b+1;f<=a;f++)c*=f;for(var f=a-b,h=2;h<=f;h++)e*=h;return c/e*Math.pow(1-d,a-b)*Math.pow(d,b)};function q(a){this.a=a;this.V=[];this.G=[];this.s=[];this.o=[];this.update()}
q.prototype.update=function(){this.o=[];var a=this.a.length-1,b=[],d=[],c=[],e=[];d[0]=0;b[0]=2;c[0]=1;e[0]=l(this.a[1].sub(this.a[0]),3);for(var f=1;f<a;f++)d[f]=1,b[f]=4,c[f]=1,e[f]=l(this.a[f+1].sub(this.a[f-1]),3);d[a]=1;b[a]=2;c[a]=0;e[a]=l(this.a[a].sub(this.a[a-1]),3);c[0]/=b[0];e[0]=l(e[0],1/b[0]);for(f=1;f<=a;f++){var h=1/(b[f]-d[f]*c[f-1]);c[f]*=h;e[f]=l(e[f].sub(l(e[f-1],d[f])),h)}for(b=a-1;0<=b;b--)e[b]=e[b].sub(l(e[b+1],c[b]));for(c=0;c<a;c++)this.V[c]=this.a[c],this.G[c]=e[c],this.s[c]=
l(this.a[c+1].sub(this.a[c]),3).sub(l(e[c],2)).sub(e[c+1]),this.o[c]=l(this.a[c].sub(this.a[c+1]),2).add(e[c]).add(e[c+1])};function r(a,b){var d=b*(a.a.length-1),c=Math.max(Math.min(Math.floor(d),a.a.length-2),0);return{c:d-c,h:c}}q.prototype.e=function(a){a=r(this,a);return this.V[a.h].add(l(this.G[a.h],a.c)).add(l(this.s[a.h],Math.pow(a.c,2))).add(l(this.o[a.h],Math.pow(a.c,3)))};
q.prototype.J=function(a){a=r(this,a);return l(this.G[a.h].add(l(this.s[a.h],2*a.c)).add(l(this.o[a.h],3*Math.pow(a.c,2))),this.a.length-1)};q.prototype.K=function(a){a=r(this,a);return l(l(this.s[a.h],2).add(l(this.o[a.h],6*a.c)),Math.pow(this.a.length-1,2))};function s(a){this.d=null;this.canvas=a;this.b=a.getContext("2d");this.q=[];this.n=[];this.l=!1;this.p=-1;this.canvas.onmousedown=this.ka.bind(this);this.canvas.onmouseup=this.ma.bind(this);this.canvas.onmousemove=this.la.bind(this);this.ga=4;this.fa="#073642";this.outlineWidth=2;this.outlineColor="#93a1a1";this.Q=6;this.ha=1.25*this.Q;this.oa=Math.pow(this.Q,2);this.ia=Math.pow(this.ha,2);this.ea=200;this.na=["#dc322f","#b58900","#859900"];this.aa=50}
function t(a){a.d.update();a.q=[];for(var b=1/a.ea,d=0,c=0;c<=a.ea;c++)a.q.push(a.d.e(d)),d+=b}
s.prototype.L=function(a){this.b.save();!0===a&&(this.b.lineJoin="round",this.b.strokeStyle=this.outlineColor,this.b.lineWidth=this.outlineWidth,this.b.beginPath(),this.b.moveTo(this.d.a[0].x,this.d.a[0].y),this.d.a.forEach(function(a){this.b.lineTo(a.x,a.y)},this),this.b.stroke());this.b.strokeStyle=this.fa;this.b.lineWidth=this.ga;this.b.beginPath();this.b.moveTo(this.q[0].x,this.q[0].y);this.q.forEach(function(a){this.b.lineTo(a.x,a.y)},this);this.b.stroke();!0===a&&this.d.a.forEach(function(a,
d){this.b.fillStyle=this.na[this.n[d]];u(this.b,a.x,a.y,this.Q)},this);this.b.restore()};s.prototype.ka=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);this.d.a.some(function(a,c){return Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)<this.ia?(this.n[c]=2,this.l=!0,this.p=c,!0):!1},this)};s.prototype.ma=function(){!0===this.l&&(this.n[this.p]=1,this.l=!1,this.p=-1)};
s.prototype.la=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);!0===this.l?(this.d.a[this.p]=b,t(this)):!1===this.l&&this.d.a.forEach(function(a,c){this.n[c]=Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)>this.oa?0:1},this)};function v(a,b,d){this.e=a;this.c=0;this.y=null;this.j=b;this.k=3<=arguments.length?arguments[2]:void 0}v.prototype.ba=function(a){var b=a-this.c;a=Math.floor(b/this.j);for(var b=b-a*this.j,d=0;d<a;d++)this.step(this.j);this.step(b)};v.prototype.step=function(a){var b=this.e(this.c,this.y,this.k);this.y.forEach(function(d,c,e){e[c]=d+a*b[c]},this);this.c+=a};function w(a,b,d){this.e=a;this.c=0;this.y=null;this.j=b;this.k=3<=arguments.length?arguments[2]:void 0}w.prototype.ba=function(a){var b=a-this.c;a=Math.floor(b/this.j);for(var b=b-a*this.j,d=0;d<a;d++)this.step(this.j);this.step(b)};
w.prototype.step=function(a){var b=a/2,d=this.e(this.c,this.y,this.k),c=this.e(this.c+b,y(this.y,d,b),this.k),e=this.e(this.c+b,y(this.y,c,b),this.k),f=this.e(this.c+a,y(this.y,e,a),this.k),h=a/6;this.y.forEach(function(a,b,x){x[b]=a+h*(d[b]+2*c[b]+2*e[b]+f[b])},this);this.c+=a};function y(a,b,d){var c=[];a.forEach(function(a,f){c.push(a+b[f]*d)});return c};function u(a,b,d,c){a.beginPath();a.arc(b,d,c,0,2*Math.PI,!1);a.fill()};function g(a,b,d,c,e,f,h,A,B,x,C,D,E,F,G){this.canvas=a;this.b=this.canvas.getContext("2d");this.T=d;this.T.onclick=this.start.bind(this);this.U=c;this.U.onclick=this.stop.bind(this);this.u=B;this.u.onchange=this.r.bind(this);this.v=x;this.v.onchange=this.r.bind(this);this.R=e;this.R.onclick=this.r.bind(this);this.M=b;this.F=C;this.F.onchange=this.S.bind(this);this.B=D;this.$=this.B.checked;this.N=h;this.O=A;this.D=E;this.ca=F;this.Y=G;this.D.onchange=this.H.bind(this);this.P=f;this.A=new s(this.canvas);
this.r();this.g={};this.S();this.H();this.ja=10/60;this.t=!1}g.prototype.r=function(){var a=this.A,b=parseInt(this.u.value,10)-1,d=parseInt(this.v.value,10),c=[];a.n=[];a.l=!1;a.p=-1;for(var e=new k(a.aa,a.canvas.height/2),f=(new k(a.canvas.width-a.aa,a.canvas.height/2)).sub(e),h=0;h<=b;h++)c.push(e.add(l(f,h/b))),a.n.push(0);a.d=0===d?new n(c):new q(c);t(a)};g.prototype.S=function(){var a=0.001*parseFloat(this.M.value);this.f=0===parseInt(this.F.value,10)?new v(z,a,this.g):new w(z,a,this.g)};
g.prototype.H=function(){this.da=parseInt(this.D.value,10);0===this.da?(this.f.e=z,this.g.m=-1*parseFloat(this.N.value),this.ca.style.display="block",this.Y.style.display="none"):(this.f.e=H,this.g.m=1E3*parseFloat(this.O.value),this.Y.style.display="block",this.ca.style.display="none")};
g.prototype.start=function(){this.g.d=this.A.d;this.S();this.H();this.g.C=parseFloat(this.P.value);this.g.I=new k(this.canvas.width/2,this.canvas.height/2);this.f.c=null;this.f.y=[0,0];this.T.style.display="none";this.U.style.display="inline";this.R.disabled=!0;this.N.disabled=!0;this.O.disabled=!0;this.D.disabled=!0;this.P.disabled=!0;this.M.disabled=!0;this.F.disabled=!0;this.B.disabled=!0;this.u.disabled=!0;this.t=this.v.disabled=!0;this.$=this.B.checked};
g.prototype.stop=function(){this.t=!1;this.U.style.display="none";this.T.style.display="inline";this.R.disabled=!1;this.N.disabled=!1;this.O.disabled=!1;this.D.disabled=!1;this.P.disabled=!1;this.M.disabled=!1;this.F.disabled=!1;this.B.disabled=!1;this.u.disabled=!1;this.v.disabled=!1};
g.prototype.L=function(a){this.b.clearRect(0,0,this.canvas.width,this.canvas.height);this.A.L(!this.t);if(!0===this.t)if(a*=0.001,null===this.f.c&&(this.f.c=a),a-this.f.c>this.ja&&(this.f.c=a),1===this.da&&(this.b.fillStyle="#b58900",u(this.b,this.g.I.x,this.g.I.y,20)),this.f.ba(a),1>=this.f.y[0]&&0<=this.f.y[0]){a=this.A.d.e(this.f.y[0]);if(!0===this.$){this.b.strokeStyle="#859900";this.b.lineWidth=3;var b=this.b,d=new k(this.g.W,this.g.X),c=b.lineWidth;b.save();b.translate(a.x,a.y);b.rotate(Math.atan2(d.y,
d.x)-0.5*Math.PI);b.beginPath();b.moveTo(0,0);d=Math.sqrt(m(d,d));b.lineTo(0,d-c);b.stroke();b.beginPath();b.moveTo(0,d);b.lineTo(-0.86*c,d-2*c);b.lineTo(0.86*c,d-2*c);b.closePath();b.stroke();b.restore()}this.b.fillStyle="#268bd2";u(this.b,a.x,a.y,10)}else this.stop()};function z(a,b,d){a=d.d.J(b[0]);var c=d.d.K(b[0]),e=-1/m(a,a)*(m(a,c)*Math.pow(b[1],2)+d.m*a.y);d.W=d.C*(c.x*Math.pow(b[1],2)+a.x*e);d.X=d.C*(c.y*Math.pow(b[1],2)+a.y*e+d.m);return[b[1],e]}
function H(a,b,d){var c=d.d.e(b[0]);a=d.d.J(b[0]);var e=d.d.K(b[0]),c=c.sub(d.I),f=1/Math.pow(Math.sqrt(m(c,c)),1.5),h=-1/m(a,a)*(m(a,e)*Math.pow(b[1],2)+d.m*m(a,c)*f);d.W=d.C*(e.x*Math.pow(b[1],2)+a.x*h+d.m*c.x*f);d.X=d.C*(e.y*Math.pow(b[1],2)+a.y*h+d.m*c.y*f);return[b[1],h]};
