(function(){function a(){d.width=window.innerWidth-c.offsetWidth;d.height=c.offsetHeight;d.style.width=d.width+"px";d.style.height=d.height+"px";f.stop();f.n()}function b(a){window.requestAnimationFrame(b);f.A(a)}var c,d,f;window.onload=function(){c=document.getElementById("controls");d=document.getElementById("main");f=new g(d,1E-4,document.getElementById("start"),document.getElementById("stop"),document.getElementById("reset"),document.getElementById("mass"),document.getElementById("grav"),document.getElementById("npoints"),
document.getElementById("type"));a();window.onresize=a;window.requestAnimationFrame(b)};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame})();function k(a,b){this.x=a;this.y=b}k.prototype.add=function(a){return new k(this.x+a.x,this.y+a.y)};k.prototype.sub=function(a){return new k(this.x-a.x,this.y-a.y)};function l(a,b){return new k(a.x*b,a.y*b)};function m(a){2<=a.length&&(this.a=a,this.update())}m.prototype.update=function(){this.h=this.a.length-1;var a=this.h-1;this.t=[];for(var b=0;b<=a;b++)this.t.push(this.a[b+1].sub(this.a[b]));a=this.h-2;this.M=[];for(b=0;b<=a;b++)this.M.push(this.t[b+1].sub(this.t[b]))};m.prototype.f=function(a){var b=new k(0,0);this.a.forEach(function(c,d){b=b.add(l(c,n(this.h,d,a)))},this);return b};
m.prototype.K=function(a){var b=this.h-1,c=new k(0,0);this.t.forEach(function(d,f){c=c.add(l(d,n(b,f,a)))},this);return l(c,this.h)};m.prototype.L=function(a){var b=this.h-2,c=new k(0,0);this.M.forEach(function(d,f){c=c.add(l(d,n(b,f,a)))},this);return l(c,this.h*(this.h-1))};function n(a,b,c){for(var d=1,f=1,e=b+1;e<=a;e++)d*=e;for(var e=a-b,h=2;h<=e;h++)f*=h;return d/f*Math.pow(1-c,a-b)*Math.pow(c,b)};function p(a){this.a=a;this.J=[];this.w=[];this.o=[];this.k=[];this.update()}
p.prototype.update=function(){this.k=[];var a=[],b=[],c=[],d=[],f=this.a.length-1;b[0]=0;a[0]=2;c[0]=1;d[0]=l(this.a[1].sub(this.a[0]),3);for(var e=1;e<f;e++)b[e]=1,a[e]=4,c[e]=1,d[e]=l(this.a[e+1].sub(this.a[e-1]),3);b[f]=1;a[f]=2;c[f]=0;d[f]=l(this.a[f].sub(this.a[f-1]),3);c[0]/=a[0];d[0]=l(d[0],1/a[0]);for(e=1;e<=f;e++){var h=1/(a[e]-b[e]*c[e-1]);c[e]*=h;d[e]=l(d[e].sub(l(d[e-1],b[e])),h)}for(a=f-1;0<=a;a--)d[a]=d[a].sub(l(d[a+1],c[a]));for(c=0;c<f;c++)this.J[c]=this.a[c],this.w[c]=d[c],this.o[c]=
l(this.a[c+1].sub(this.a[c]),3).sub(l(d[c],2)).sub(d[c+1]),this.k[c]=l(this.a[c].sub(this.a[c+1]),2).add(d[c]).add(d[c+1])};function q(a,b){var c=b*(a.a.length-1),d=Math.max(Math.min(Math.floor(c),a.a.length-2),0);return{c:c-d,g:d}}p.prototype.f=function(a){a=q(this,a);return this.J[a.g].add(l(this.w[a.g],a.c)).add(l(this.o[a.g],Math.pow(a.c,2))).add(l(this.k[a.g],Math.pow(a.c,3)))};
p.prototype.K=function(a){a=q(this,a);return l(this.w[a.g].add(l(this.o[a.g],2*a.c)).add(l(this.k[a.g],3*Math.pow(a.c,2))),this.a.length-1)};p.prototype.L=function(a){a=q(this,a);return l(l(this.o[a.g],2).add(l(this.k[a.g],6*a.c)),Math.pow(this.a.length-1,2))};function r(a){this.d=null;this.canvas=a;this.b=a.getContext("2d");this.m=[];this.j=[];this.i=!1;this.l=-1;this.canvas.onmousedown=this.V.bind(this);this.canvas.onmouseup=this.X.bind(this);this.canvas.onmousemove=this.W.bind(this);this.Q=4;this.P="#073642";this.outlineWidth=2;this.outlineColor="#93a1a1";this.D=6;this.S=1.25*this.D;this.Z=Math.pow(this.D,2);this.T=Math.pow(this.S,2);this.O=200;this.Y=["#dc322f","#b58900","#859900"];this.N=50}
function s(a){a.d.update();a.m=[];for(var b=1/a.O,c=0,d=0;d<=a.O;d++)a.m.push(a.d.f(c)),c+=b}
r.prototype.A=function(a){this.b.save();!0===a&&(this.b.lineJoin="round",this.b.strokeStyle=this.outlineColor,this.b.lineWidth=this.outlineWidth,this.b.beginPath(),this.b.moveTo(this.d.a[0].x,this.d.a[0].y),this.d.a.forEach(function(a){this.b.lineTo(a.x,a.y)},this),this.b.stroke());this.b.strokeStyle=this.P;this.b.lineWidth=this.Q;this.b.beginPath();this.b.moveTo(this.m[0].x,this.m[0].y);this.m.forEach(function(a){this.b.lineTo(a.x,a.y)},this);this.b.stroke();!0===a&&this.d.a.forEach(function(a,c){this.b.fillStyle=
this.Y[this.j[c]];var d=this.b,f=a.x,e=a.y,h=this.D;d.beginPath();d.arc(f,e,h,0,2*Math.PI,!1);d.fill()},this);this.b.restore()};r.prototype.V=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);this.d.a.some(function(a,d){return Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)<this.T?(this.j[d]=2,this.i=!0,this.l=d,!0):!1},this)};r.prototype.X=function(){!0===this.i&&(this.j[this.l]=1,this.i=!1,this.l=-1)};
r.prototype.W=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);!0===this.i?(this.d.a[this.l]=b,s(this)):!1===this.i&&this.d.a.forEach(function(a,d){this.j[d]=Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)>this.Z?0:1},this)};function t(a,b,c){this.f=a;this.c=0;this.y=null;this.H=b;this.q=3<=arguments.length?arguments[2]:void 0}t.prototype.step=function(a){var b=a/2,c=this.f(this.c,this.y,this.q),d=this.f(this.c+b,u(this.y,c,b),this.q),f=this.f(this.c+b,u(this.y,d,b),this.q),e=this.f(this.c+a,u(this.y,f,a),this.q),h=a/6;this.y.forEach(function(a,b,x){x[b]=a+h*(c[b]+2*d[b]+2*f[b]+e[b])},this);this.c+=a};function u(a,b,c){var d=[];a.forEach(function(a,e){d.push(a+b[e]*c)});return d};function g(a,b,c,d,f,e,h,v,w){this.canvas=a;this.b=this.canvas.getContext("2d");this.G=c;this.G.onclick=this.start.bind(this);this.I=d;this.I.onclick=this.stop.bind(this);this.r=v;this.r.onchange=this.n.bind(this);this.s=w;this.s.onchange=this.n.bind(this);this.F=f;this.F.onclick=this.n.bind(this);this.B=h;this.C=e;this.u=new r(this.canvas);this.n();this.v={};this.e=new t(y,b,this.v);this.U=10/60;this.p=!1}
g.prototype.n=function(){var a=this.u,b=parseInt(this.r.value,10)-1,c=parseInt(this.s.value,10),d=[];a.j=[];a.i=!1;a.l=-1;for(var f=new k(a.N,a.canvas.height/2),e=(new k(a.canvas.width-a.N,a.canvas.height/2)).sub(f),h=0;h<=b;h++)d.push(f.add(l(e,h/b))),a.j.push(0);a.d=0===c?new m(d):new p(d);s(a)};
g.prototype.start=function(){this.v.d=this.u.d;this.v.R=-1*parseFloat(this.B.value);this.v.$=parseFloat(this.C.value);this.e.c=null;this.e.y=[0,0];this.G.style.display="none";this.I.style.display="inline";this.F.disabled=!0;this.B.disabled=!0;this.C.disabled=!0;this.r.disabled=!0;this.p=this.s.disabled=!0};g.prototype.stop=function(){this.p=!1;this.I.style.display="none";this.G.style.display="inline";this.F.disabled=!1;this.B.disabled=!1;this.C.disabled=!1;this.r.disabled=!1;this.s.disabled=!1};
g.prototype.A=function(a){this.b.clearRect(0,0,this.canvas.width,this.canvas.height);this.u.A(!this.p);if(!0===this.p){var b=0.001*a;null===this.e.c&&(this.e.c=b);b-this.e.c>this.U&&(this.e.c=b);a=this.e;for(var c=b-a.c,b=Math.floor(c/a.H),c=c-b*a.H,d=0;d<b;d++)a.step(a.H);a.step(c);1>=this.e.y[0]&&0<=this.e.y[0]?(this.b.fillStyle="#268bd2",c=this.u.d.f(this.e.y[0]),a=this.b,b=c.x,c=c.y,a.beginPath(),a.arc(b,c,10,0,2*Math.PI,!1),a.fill()):this.stop()}};
function y(a,b,c){c.d.f(b[0]);a=c.d.K(b[0]);var d=c.d.L(b[0]);return[b[1],-1/(a.x*a.x+a.y*a.y)*((a.x*d.x+a.y*d.y)*Math.pow(b[1],2)+c.R*a.y)]};
