(function(){function a(){c.width=window.innerWidth-d.offsetWidth;c.height=d.offsetHeight;c.style.width=c.width+"px";c.style.height=c.height+"px";e.stop();e.q()}function b(a){window.requestAnimationFrame(b);e.F(a)}var d,c,e;window.onload=function(){d=document.getElementById("controls");c=document.getElementById("main");e=new g(c,document.getElementById("dt"),document.getElementById("start"),document.getElementById("stop"),document.getElementById("reset"),document.getElementById("mass"),document.getElementById("grav"),
document.getElementById("npoints"),document.getElementById("type"),document.getElementById("solver"),document.getElementById("force"));a();window.onresize=a;window.requestAnimationFrame(b)};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame})();function k(a,b){this.x=a;this.y=b}k.prototype.add=function(a){return new k(this.x+a.x,this.y+a.y)};k.prototype.sub=function(a){return new k(this.x-a.x,this.y-a.y)};function l(a,b){return new k(a.x*b,a.y*b)};function m(a){2<=a.length&&(this.a=a,this.update())}m.prototype.update=function(){this.h=this.a.length-1;var a=this.h-1;this.v=[];for(var b=0;b<=a;b++)this.v.push(this.a[b+1].sub(this.a[b]));a=this.h-2;this.Q=[];for(b=0;b<=a;b++)this.Q.push(this.v[b+1].sub(this.v[b]))};m.prototype.e=function(a){var b=new k(0,0);this.a.forEach(function(d,c){b=b.add(l(d,n(this.h,c,a)))},this);return b};
m.prototype.O=function(a){var b=this.h-1,d=new k(0,0);this.v.forEach(function(c,e){d=d.add(l(c,n(b,e,a)))},this);return l(d,this.h)};m.prototype.P=function(a){var b=this.h-2,d=new k(0,0);this.Q.forEach(function(c,e){d=d.add(l(c,n(b,e,a)))},this);return l(d,this.h*(this.h-1))};function n(a,b,d){for(var c=1,e=1,f=b+1;f<=a;f++)c*=f;for(var f=a-b,h=2;h<=f;h++)e*=h;return c/e*Math.pow(1-d,a-b)*Math.pow(d,b)};function p(a){this.a=a;this.N=[];this.D=[];this.r=[];this.n=[];this.update()}
p.prototype.update=function(){this.n=[];var a=this.a.length-1,b=[],d=[],c=[],e=[];d[0]=0;b[0]=2;c[0]=1;e[0]=l(this.a[1].sub(this.a[0]),3);for(var f=1;f<a;f++)d[f]=1,b[f]=4,c[f]=1,e[f]=l(this.a[f+1].sub(this.a[f-1]),3);d[a]=1;b[a]=2;c[a]=0;e[a]=l(this.a[a].sub(this.a[a-1]),3);c[0]/=b[0];e[0]=l(e[0],1/b[0]);for(f=1;f<=a;f++){var h=1/(b[f]-d[f]*c[f-1]);c[f]*=h;e[f]=l(e[f].sub(l(e[f-1],d[f])),h)}for(b=a-1;0<=b;b--)e[b]=e[b].sub(l(e[b+1],c[b]));for(c=0;c<a;c++)this.N[c]=this.a[c],this.D[c]=e[c],this.r[c]=
l(this.a[c+1].sub(this.a[c]),3).sub(l(e[c],2)).sub(e[c+1]),this.n[c]=l(this.a[c].sub(this.a[c+1]),2).add(e[c]).add(e[c+1])};function q(a,b){var d=b*(a.a.length-1),c=Math.max(Math.min(Math.floor(d),a.a.length-2),0);return{c:d-c,g:c}}p.prototype.e=function(a){a=q(this,a);return this.N[a.g].add(l(this.D[a.g],a.c)).add(l(this.r[a.g],Math.pow(a.c,2))).add(l(this.n[a.g],Math.pow(a.c,3)))};
p.prototype.O=function(a){a=q(this,a);return l(this.D[a.g].add(l(this.r[a.g],2*a.c)).add(l(this.n[a.g],3*Math.pow(a.c,2))),this.a.length-1)};p.prototype.P=function(a){a=q(this,a);return l(l(this.r[a.g],2).add(l(this.n[a.g],6*a.c)),Math.pow(this.a.length-1,2))};function r(a){this.d=null;this.canvas=a;this.b=a.getContext("2d");this.p=[];this.m=[];this.l=!1;this.o=-1;this.canvas.onmousedown=this.da.bind(this);this.canvas.onmouseup=this.fa.bind(this);this.canvas.onmousemove=this.ea.bind(this);this.$=4;this.Z="#073642";this.outlineWidth=2;this.outlineColor="#93a1a1";this.I=6;this.aa=1.25*this.I;this.ha=Math.pow(this.I,2);this.ba=Math.pow(this.aa,2);this.W=200;this.ga=["#dc322f","#b58900","#859900"];this.T=50}
function s(a){a.d.update();a.p=[];for(var b=1/a.W,d=0,c=0;c<=a.W;c++)a.p.push(a.d.e(d)),d+=b}
r.prototype.F=function(a){this.b.save();!0===a&&(this.b.lineJoin="round",this.b.strokeStyle=this.outlineColor,this.b.lineWidth=this.outlineWidth,this.b.beginPath(),this.b.moveTo(this.d.a[0].x,this.d.a[0].y),this.d.a.forEach(function(a){this.b.lineTo(a.x,a.y)},this),this.b.stroke());this.b.strokeStyle=this.Z;this.b.lineWidth=this.$;this.b.beginPath();this.b.moveTo(this.p[0].x,this.p[0].y);this.p.forEach(function(a){this.b.lineTo(a.x,a.y)},this);this.b.stroke();!0===a&&this.d.a.forEach(function(a,d){this.b.fillStyle=
this.ga[this.m[d]];var c=this.b,e=a.x,f=a.y,h=this.I;c.beginPath();c.arc(e,f,h,0,2*Math.PI,!1);c.fill()},this);this.b.restore()};r.prototype.da=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);this.d.a.some(function(a,c){return Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)<this.ba?(this.m[c]=2,this.l=!0,this.o=c,!0):!1},this)};r.prototype.fa=function(){!0===this.l&&(this.m[this.o]=1,this.l=!1,this.o=-1)};
r.prototype.ea=function(a){var b=new k(a.clientX-this.canvas.offsetLeft,a.clientY-this.canvas.offsetTop);!0===this.l?(this.d.a[this.o]=b,s(this)):!1===this.l&&this.d.a.forEach(function(a,c){this.m[c]=Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)>this.ha?0:1},this)};function t(a,b,d){this.e=a;this.c=0;this.y=null;this.j=b;this.k=3<=arguments.length?arguments[2]:void 0}t.prototype.U=function(a){var b=a-this.c;a=Math.floor(b/this.j);for(var b=b-a*this.j,d=0;d<a;d++)this.step(this.j);this.step(b)};t.prototype.step=function(a){var b=this.e(this.c,this.y,this.k);this.y.forEach(function(d,c,e){e[c]=d+a*b[c]},this);this.c+=a};function u(a,b,d){this.e=a;this.c=0;this.y=null;this.j=b;this.k=3<=arguments.length?arguments[2]:void 0}u.prototype.U=function(a){var b=a-this.c;a=Math.floor(b/this.j);for(var b=b-a*this.j,d=0;d<a;d++)this.step(this.j);this.step(b)};
u.prototype.step=function(a){var b=a/2,d=this.e(this.c,this.y,this.k),c=this.e(this.c+b,w(this.y,d,b),this.k),e=this.e(this.c+b,w(this.y,c,b),this.k),f=this.e(this.c+a,w(this.y,e,a),this.k),h=a/6;this.y.forEach(function(a,b,v){v[b]=a+h*(d[b]+2*c[b]+2*e[b]+f[b])},this);this.c+=a};function w(a,b,d){var c=[];a.forEach(function(a,f){c.push(a+b[f]*d)});return c};function g(a,b,d,c,e,f,h,y,z,v,A){this.canvas=a;this.b=this.canvas.getContext("2d");this.L=d;this.L.onclick=this.start.bind(this);this.M=c;this.M.onclick=this.stop.bind(this);this.t=y;this.t.onchange=this.q.bind(this);this.u=z;this.u.onchange=this.q.bind(this);this.J=e;this.J.onclick=this.q.bind(this);this.w=b;this.w.onchange=this.K.bind(this);this.C=v;this.C.onchange=this.K.bind(this);this.B=A;this.R=this.B.checked;this.G=h;this.H=f;this.A=new r(this.canvas);this.q();this.i={};this.K();this.ca=10/
60;this.s=!1}g.prototype.q=function(){var a=this.A,b=parseInt(this.t.value,10)-1,d=parseInt(this.u.value,10),c=[];a.m=[];a.l=!1;a.o=-1;for(var e=new k(a.T,a.canvas.height/2),f=(new k(a.canvas.width-a.T,a.canvas.height/2)).sub(e),h=0;h<=b;h++)c.push(e.add(l(f,h/b))),a.m.push(0);a.d=0===d?new m(c):new p(c);s(a)};g.prototype.K=function(){var a=0.001*parseFloat(this.w.value);this.f=0===parseInt(this.C.value,10)?new t(x,a,this.i):new u(x,a,this.i)};
g.prototype.start=function(){this.i.d=this.A.d;this.i.S=-1*parseFloat(this.G.value);this.i.V=parseFloat(this.H.value);this.f.c=null;this.f.y=[0,0];this.L.style.display="none";this.M.style.display="inline";this.J.disabled=!0;this.G.disabled=!0;this.H.disabled=!0;this.w.disabled=!0;this.C.disabled=!0;this.B.disabled=!0;this.t.disabled=!0;this.s=this.u.disabled=!0;this.R=this.B.checked};
g.prototype.stop=function(){this.s=!1;this.M.style.display="none";this.L.style.display="inline";this.J.disabled=!1;this.G.disabled=!1;this.H.disabled=!1;this.w.disabled=!1;this.C.disabled=!1;this.B.disabled=!1;this.t.disabled=!1;this.u.disabled=!1};
g.prototype.F=function(a){this.b.clearRect(0,0,this.canvas.width,this.canvas.height);this.A.F(!this.s);if(!0===this.s)if(a*=0.001,null===this.f.c&&(this.f.c=a),a-this.f.c>this.ca&&(this.f.c=a),this.f.U(a),1>=this.f.y[0]&&0<=this.f.y[0]){a=this.A.d.e(this.f.y[0]);if(!0===this.R){this.b.strokeStyle="#859900";this.b.lineWidth=3;var b=this.b,d=new k(this.i.X,this.i.Y),c=b.lineWidth;b.save();b.translate(a.x,a.y);b.rotate(Math.atan2(d.y,d.x)-0.5*Math.PI);b.beginPath();b.moveTo(0,0);d=Math.sqrt(d.x*d.x+
d.y*d.y);b.lineTo(0,d-c);b.stroke();b.beginPath();b.moveTo(0,d);b.lineTo(-0.86*c,d-2*c);b.lineTo(0.86*c,d-2*c);b.closePath();b.stroke();b.restore()}this.b.fillStyle="#268bd2";b=this.b;c=a.x;a=a.y;b.beginPath();b.arc(c,a,10,0,2*Math.PI,!1);b.fill()}else this.stop()};function x(a,b,d){a=d.d.O(b[0]);var c=d.d.P(b[0]),e=-1/(a.x*a.x+a.y*a.y)*((a.x*c.x+a.y*c.y)*Math.pow(b[1],2)+d.S*a.y);d.X=d.V*(c.x*Math.pow(b[1],2)+a.x*e);d.Y=d.V*(c.y*Math.pow(b[1],2)+a.y*e+d.S);return[b[1],e]};
